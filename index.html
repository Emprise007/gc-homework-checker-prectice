<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¸ëœë“œì²´ì´ìŠ¤ ìˆ™ì œí‘œ</title>
    <style>
        /* ê¸°ë³¸ ë””ìì¸ ë° GC í…Œë§ˆ */
        body { 
            background-color: #1a1a2e; 
            color: #fff; 
            font-family: 'Malgun Gothic', sans-serif; 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            margin: 0; 
        }
        .container { 
            width: 100%; 
            max-width: 1000px; /* ë„“ê²Œ ì¡°ì • */
            background-color: #16213e; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
        }
        h1 { text-align: center; color: #e94560; margin-bottom: 5px; }
        p.sub-title { text-align: center; color: #888; font-size: 0.9em; margin-top: 0; margin-bottom: 20px; }
        h2 { 
            border-bottom: 2px solid #0f3460; 
            padding-bottom: 5px; 
            margin-top: 30px; 
            font-size: 1.2em; 
            color: #aeb8c9; 
            text-align: center;
        }
        
        /* ìºë¦­í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #character-selector { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 8px; 
            margin-bottom: 20px; 
        }
        .char-btn { 
            background-color: #0f3460; 
            color: #fff; 
            border: 1px solid #16213e; 
            padding: 8px 12px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.9em; 
            transition: background-color 0.2s, border-color 0.2s;
        }
        .char-btn:hover { background-color: #1a1a2e; }
        .char-btn.active { background-color: #e94560; border-color: #fff; font-weight: bold; }

        /* ì¢Œìš° ë¶„í•  ë ˆì´ì•„ì›ƒ */
        #task-view-container { 
            display: flex; 
            gap: 20px; 
            margin-top: 20px;
        }
        .task-column { 
            flex: 1; 
            background-color: #0f1a35; 
            padding: 15px; 
            border-radius: 8px;
        }

        /* ìˆ™ì œ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .task-item { 
            display: flex; 
            align-items: center; 
            background-color: #0f3460; 
            margin-bottom: 8px; 
            padding: 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: 0.2s; 
            font-size: 0.95em;
        }
        .task-item.done { opacity: 0.5; text-decoration: line-through; }
        
        input[type="checkbox"] { transform: scale(1.1); margin-right: 15px; cursor: pointer; }
        label { cursor: pointer; flex-grow: 1; font-weight: bold; }
        
        .account-shared-tag { 
            font-size: 0.75em; 
            background-color: #007bff; 
            padding: 2px 6px; 
            border-radius: 3px; 
            margin-left: 10px;
        }
        
        .reset-info { font-size: 0.8em; color: #e94560; margin-left: 5px; }
        .footer { margin-top: 30px; text-align: center; font-size: 0.8em; color: #666; }
        
        @media (max-width: 768px) {
            #task-view-container {
                flex-direction: column; /* ëª¨ë°”ì¼ì—ì„œëŠ” ìœ„ì•„ë˜ë¡œ ë‹¤ì‹œ ë°°ì¹˜ */
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ê·¸ëœë“œì²´ì´ìŠ¤ ìˆ™ì œí‘œ</h1>
    <p class="sub-title">ì¼ì¼: ë§¤ì¼ 15:00 ì´ˆê¸°í™” | ì£¼ê°„: ìˆ˜ìš”ì¼ 15:00 ì´ˆê¸°í™” (KST)</p>

    <h2>ìºë¦­í„° ì„ íƒ</h2>
    <div id="character-selector"></div>
    
    <h2 id="current-char-name"></h2>

    <div id="task-view-container">
        <div class="task-column">
            <h3 style="color: #aeb8c9;">ğŸ“… ì¼ì¼ ìˆ™ì œ (ìºë¦­í„°ë³„)</h3>
            <div id="daily-list"></div>
        </div>

        <div class="task-column">
            <h3 style="color: #aeb8c9;">âš”ï¸ ì£¼ê°„/ê³„ì • ê³µìœ  ìˆ™ì œ</h3>
            <div id="weekly-list"></div>
        </div>
    </div>

    <div class="footer">
        ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤. (ê¸°ê¸° ê°„ ì—°ë™ X)
    </div>
</div>

<script>
    // === 1. ê¸°ë³¸ ë°ì´í„° ì„¤ì • ===

    // 24ê°œ ìºë¦­í„° ë¦¬ìŠ¤íŠ¸
    const CHARACTER_NAMES = [
        'ì—˜ë¦¬ì‹œìŠ¤', 'ë¦¬ë¥´', 'ì•„ë¥´ë©”', 'ë¼ìŠ¤', 'ë¼ì´ì–¸', 'ë¡œë‚œ', 'ì—ì´ë¯¸', 'ì§„', 'ì§€í¬í•˜íŠ¸', 'ë§ˆë¦¬', 
        'ë””ì˜¤', 'ì œë¡œ', 'ë ˆì´', 'ë£¨í¼ìŠ¤', 'ë² ì´ê°€ìŠ¤', 'ë¦°', 'ì•„ì‹ ', 'ë¼ì„', 'ì—ë¸', 'ë°ì¹´ë„¤', 
        'ì•„ì´', 'ì¹¼ë¦¬ì•„', 'ìš°ë…¸', 'ì´ë¦¬ìŠ¤'
    ];

    // ë˜ì „ ëª©ë¡ (ID, ì´ë¦„, ê·¸ë¦¬ê³  ê³„ì • ê³µìœ  ì—¬ë¶€)
    const DUNGEON_DATA = {
        daily: [
            { id: 'berkas', name: 'ë² ë¥´ì¹´ìŠ¤ì˜ ìš”ìƒˆ', shared: false },
            { id: 'tower', name: 'ì†Œë©¸ì˜ íƒ‘', shared: false },
            { id: 'void', name: 'ê³µí—ˆ', shared: false },
            { id: 'wanted', name: 'í˜„ìƒìˆ˜ë°° (GP/íë¸Œ)', shared: false },
            { id: 'tero', name: 'ì´ì„¸ê³„: í…Œë¡œì¹´ ê³µì„±ì „', shared: false },
            { id: 'temple', name: 'ì´ì„¸ê³„: ì‹œê°„ì˜ ì‚¬ì›', shared: false },
            { id: 'kounat', name: 'ì´ì„¸ê³„: ì½”ìš°ë‚˜íŠ¸ ëŒ€í­ë°œ', shared: false },
            // ê³„ì • ê³µìœ  ì¼ì¼ ìˆ™ì œ (ë¬´í•œíšŒë‘)ëŠ” ë³„ë„ë¡œ ê´€ë¦¬ (Weekly listë¡œ ì´ë™)
        ],
        weekly: [
            { id: 'judge', name: 'ì‹¬íŒì˜ ë•…', type: 'weekly', shared: false }, // ì£¼ê°„ìœ¼ë¡œ ì´ë™
            { id: 'abyss', name: 'ì‹¬ì—°ì˜ ê¸¸', type: 'weekly', shared: false }, // ì£¼ê°„ìœ¼ë¡œ ì´ë™
            { id: 'w_furnace', name: 'ì§€ì˜¥ì˜ ìš©ê´‘ë¡œ', type: 'weekly', shared: false },
            { id: 'w_sanctum', name: 'íŒŒë©¸ì˜ ì„±ì†Œ', type: 'weekly', shared: false },
            { id: 'w_laby', name: 'í™˜ì˜ì˜ ë¯¸ê¶', type: 'weekly', shared: false },
            { id: 'corridor', name: 'ë¬´í•œíšŒë‘', type: 'daily', shared: true } // ì¼ì¼/ê³„ì • ê³µìœ 
        ]
    };

    let characters = []; // ì „ì²´ ìºë¦­í„° ë°ì´í„°
    let currentChrId = null; // í˜„ì¬ ì„ íƒëœ ìºë¦­í„° ID

    // === 2. ë°ì´í„° ì´ˆê¸°í™”/ë¶ˆëŸ¬ì˜¤ê¸° ===

    // ë¹ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
    const generateInitialTasks = (type) => {
        const tasks = {};
        DUNGEON_DATA[type].forEach(d => {
            tasks[d.id] = false;
        });
        return tasks;
    };

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê³„ì • ê³µìœ  ìˆ™ì œ(ë¬´í•œíšŒë‘) ìƒíƒœë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const getAccountSharedTaskStatus = (id) => {
        return localStorage.getItem(`shared_${id}`) === 'true';
    };

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ê³„ì • ê³µìœ  ìˆ™ì œ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
    const setAccountSharedTaskStatus = (id, status) => {
        localStorage.setItem(`shared_${id}`, status);
    };

    function initializeData() {
        const savedData = localStorage.getItem('gc_characters');
        const lastReset = localStorage.getItem('lastResetTime');

        if (savedData) {
            characters = JSON.parse(savedData);
        } else {
            // ë¡œì»¬ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 24ê°œ ìºë¦­í„° ìƒì„±
            characters = CHARACTER_NAMES.map((name, index) => ({
                id: index + 1,
                name: name,
                dailyTasks: generateInitialTasks('daily'),
                weeklyTasks: generateInitialTasks('weekly')
            }));
            localStorage.setItem('gc_characters', JSON.stringify(characters));
        }
        
        currentChrId = localStorage.getItem('currentChrId') || characters[0].id;
        
        checkAndApplyReset(characters, lastReset);
    }

    // === 3. ì´ˆê¸°í™” ë¡œì§ (í•µì‹¬) ===
    function checkAndApplyReset(currentChars, lastResetTime) {
        const now = new Date();
        const kstNow = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
        let isDailyReset = false;
        let isWeeklyReset = false;

        let dailyResetPoint = new Date(kstNow);
        if (kstNow.getHours() < 15) { dailyResetPoint.setDate(dailyResetPoint.getDate() - 1); }
        dailyResetPoint.setHours(15, 0, 0, 0);

        let weeklyResetPoint = new Date(kstNow);
        const day = weeklyResetPoint.getDay(); 
        const diff = (day + 7 - 3) % 7; 
        weeklyResetPoint.setDate(weeklyResetPoint.getDate() - diff);
        weeklyResetPoint.setHours(15, 0, 0, 0);
        if (weeklyResetPoint > kstNow) weeklyResetPoint.setDate(weeklyResetPoint.getDate() - 7);

        const lastCheckTime = lastResetTime ? parseInt(lastResetTime) : 0;
        
        if (lastCheckTime < dailyResetPoint.getTime()) { isDailyReset = true; }
        if (lastCheckTime < weeklyResetPoint.getTime()) { isWeeklyReset = true; }

        if (isDailyReset || isWeeklyReset) {
            console.log(`Resetting: Daily=${isDailyReset}, Weekly=${isWeeklyReset}`);
            
            characters = currentChars.map(char => {
                let newChar = {...char};
                
                // 1. ìºë¦­í„°ë³„ ìˆ™ì œ ì´ˆê¸°í™”
                if (isDailyReset) newChar.dailyTasks = generateInitialTasks('daily');
                if (isWeeklyReset) newChar.weeklyTasks = generateInitialTasks('weekly');
                return newChar;
            });
            
            // 2. ê³„ì • ê³µìœ  ìˆ™ì œ ì´ˆê¸°í™” (ë¬´í•œíšŒë‘)
            if (isDailyReset) {
                const infiniteCorridor = DUNGEON_DATA.weekly.find(d => d.id === 'corridor');
                if (infiniteCorridor && infiniteCorridor.shared) {
                    setAccountSharedTaskStatus('corridor', false);
                }
            }
            
            localStorage.setItem('gc_characters', JSON.stringify(characters));
            localStorage.setItem('lastResetTime', now.getTime());
        }
    }

    // === 4. ì•¡ì…˜ í•¸ë“¤ëŸ¬ ===

    function selectCharacter(id) {
        currentChrId = id;
        localStorage.setItem('currentChrId', id);
        render();
    }

    function toggleTask(chrId, type, taskId, shared) {
        if (shared) {
            // ê³„ì • ê³µìœ  ìˆ™ì œ ì²˜ë¦¬: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì˜ ê³µìœ  ìƒíƒœë¥¼ ë³€ê²½
            const newStatus = !getAccountSharedTaskStatus(taskId);
            setAccountSharedTaskStatus(taskId, newStatus);
            // ëª¨ë“  ìºë¦­í„°ì— ì´ ë³€ê²½ ì‚¬í•­ì€ ë™ì¼í•˜ê²Œ ì ìš©ë¨ (ë³„ë„ ìºë¦­í„° ë°ì´í„° ì—…ë°ì´íŠ¸ ë¶ˆí•„ìš”)
        } else {
            // ìºë¦­í„°ë³„ ìˆ™ì œ ì²˜ë¦¬
            const charIndex = characters.findIndex(c => c.id === chrId);
            if (charIndex === -1) return;
    
            const char = characters[charIndex];
            const newStatus = !char[`${type}Tasks`][taskId];
            char[`${type}Tasks`] = {
                ...char[`${type}Tasks`],
                [taskId]: newStatus
            };
            localStorage.setItem('gc_characters', JSON.stringify(characters));
        }

        render();
    }

    // === 5. í™”ë©´ ë Œë”ë§ ===

    function renderCharacterSelector() {
        const selector = document.getElementById('character-selector');
        selector.innerHTML = '';

        characters.forEach(char => {
            const button = document.createElement('button');
            button.className = `char-btn ${char.id == currentChrId ? 'active' : ''}`;
            button.innerText = char.name;
            button.onclick = () => selectCharacter(char.id);
            selector.appendChild(button);
        });
    }

    function renderTaskList() {
        const currentCharacter = characters.find(c => c.id == currentChrId);
        if (!currentCharacter) {
            document.getElementById('current-char-name').innerText = 'ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
            document.getElementById('task-view-container').style.display = 'none';
            return;
        }
        
        document.getElementById('task-view-container').style.display = 'flex';
        document.getElementById('current-char-name').innerText = `í˜„ì¬ ì„ íƒ ìºë¦­í„°: [${currentCharacter.name}]`;

        const renderList = (type, listId) => {
            const container = document.getElementById(listId);
            container.innerHTML = '';
            
            const listToRender = DUNGEON_DATA[type];
            
            listToRender.forEach(item => {
                const isShared = item.shared || false;
                let isChecked;

                if (isShared) {
                    isChecked = getAccountSharedTaskStatus(item.id);
                } else {
                    isChecked = currentCharacter[`${type}Tasks`][item.id] || false;
                }
                
                const div = document.createElement('div');
                div.onclick = () => toggleTask(currentCharacter.id, type, item.id, isShared);
                div.className = `task-item ${isChecked ? 'done' : ''}`;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = isChecked;
                checkbox.onclick = (e) => {
                    e.stopPropagation(); 
                    toggleTask(currentCharacter.id, type, item.id, isShared);
                };

                const label = document.createElement('label');
                label.innerText = item.name;
                
                if (isShared) {
                    const tag = document.createElement('span');
                    tag.className = 'account-shared-tag';
                    tag.innerText = 'ê³„ì • ê³µìœ ';
                    label.appendChild(tag);
                }

                div.appendChild(checkbox);
                div.appendChild(label);
                container.appendChild(div);
            });
        };

        renderList('daily', 'daily-list');
        renderList('weekly', 'weekly-list');
    }
    
    function render() {
        initializeData();
        renderCharacterSelector();
        renderTaskList();
    }

    // === 6. ì‹œì‘ ë° ì£¼ê¸°ì  ì²´í¬ ===
    
    render();
    
    setInterval(render, 60000); 

</script>

</body>
</html>
