<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¸ëœë“œì²´ì´ìŠ¤ í´ë˜ì‹ ìºë¦­í„°ë³„ ìˆ™ì œí‘œ</title>
    <style>
        /* ê¸°ë³¸ ë””ìì¸ ë° GC í…Œë§ˆ */
        body { background-color: #1a1a2e; color: #fff; font-family: 'Malgun Gothic', sans-serif; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 600px; background-color: #16213e; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: #e94560; margin-bottom: 5px; }
        p.sub-title { text-align: center; color: #888; font-size: 0.9em; margin-top: 0; margin-bottom: 20px; }
        h2 { border-bottom: 2px solid #0f3460; padding-bottom: 5px; margin-top: 30px; font-size: 1.2em; color: #aeb8c9; }
        
        /* ìºë¦­í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #character-selector { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .char-btn { 
            background-color: #0f3460; color: #fff; border: 1px solid #16213e; padding: 8px 12px; border-radius: 6px; cursor: pointer; 
            font-size: 0.9em; transition: background-color 0.2s, border-color 0.2s;
        }
        .char-btn:hover { background-color: #1a1a2e; }
        .char-btn.active { background-color: #e94560; border-color: #fff; font-weight: bold; }

        /* ìˆ™ì œ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .task-item { display: flex; align-items: center; background-color: #0f3460; margin-bottom: 10px; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .task-item:hover { background-color: #1a1a2e; }
        .task-item.done { opacity: 0.5; text-decoration: line-through; }
        
        input[type="checkbox"] { transform: scale(1.3); margin-right: 15px; cursor: pointer; }
        label { cursor: pointer; flex-grow: 1; font-weight: bold; }
        
        .reset-info { font-size: 0.8em; color: #e94560; margin-left: 5px; }
        .footer { margin-top: 30px; text-align: center; font-size: 0.8em; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h1>ìºë¦­í„°ë³„ GC ìˆ™ì œí‘œ</h1>
    <p class="sub-title">ì¼ì¼: ë§¤ì¼ 15:00 ì´ˆê¸°í™” | ì£¼ê°„: ìˆ˜ìš”ì¼ 15:00 ì´ˆê¸°í™” (KST)</p>

    <h2>ìºë¦­í„° ì„ íƒ</h2>
    <div id="character-selector"></div>
    
    <h2 id="current-char-name"></h2>

    <div id="task-lists">
        <h3 style="color: #aeb8c9;">ğŸ“… ì¼ì¼ ìˆ™ì œ</h3>
        <div id="daily-list"></div>

        <h3 style="color: #aeb8c9;">âš”ï¸ ì£¼ê°„ ìˆ™ì œ</h3>
        <div id="weekly-list"></div>
    </div>

    <div class="footer">
        ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤. (ê¸°ê¸° ê°„ ì—°ë™ X)
    </div>
</div>

<script>
    // === 1. ê¸°ë³¸ ë°ì´í„° ì„¤ì • ===

    // 24ê°œ ìºë¦­í„° ë¦¬ìŠ¤íŠ¸
    const CHARACTER_NAMES = [
        'ì—˜ë¦¬ì‹œìŠ¤', 'ë¦¬ë¥´', 'ì•„ë¥´ë©”', 'ë¼ìŠ¤', 'ë¼ì´ì–¸', 'ë¡œë‚œ', 'ì—ì´ë¯¸', 'ì§„', 'ì§€í¬í•˜íŠ¸', 'ë§ˆë¦¬', 
        'ë””ì˜¤', 'ì œë¡œ', 'ë ˆì´', 'ë£¨í¼ìŠ¤', 'ë² ì´ê°€ìŠ¤', 'ë¦°', 'ì•„ì‹ ', 'ë¼ì„', 'ì—ë¸', 'ë°ì¹´ë„¤', 
        'ì•„ì´', 'ì¹¼ë¦¬ì•„', 'ìš°ë…¸', 'ì´ë¦¬ìŠ¤'
    ];

    // ë˜ì „ ëª©ë¡ (IDì™€ ì´ë¦„)
    const DUNGEON_DATA = {
        daily: [
            { id: 'berkas', name: 'ë² ë¥´ì¹´ìŠ¤ì˜ ìš”ìƒˆ' },
            { id: 'tower', name: 'ì†Œë©¸ì˜ íƒ‘' },
            { id: 'judge', name: 'ì‹¬íŒì˜ ë•…' },
            { id: 'corridor', name: 'ë¬´í•œíšŒë‘' },
            { id: 'abyss', name: 'ì‹¬ì—°ì˜ ê¸¸' },
            { id: 'void', name: 'ê³µí—ˆ' },
            { id: 'wanted', name: 'í˜„ìƒìˆ˜ë°° (GP/íë¸Œ)' },
            { id: 'tero', name: 'ì´ì„¸ê³„: í…Œë¡œì¹´ ê³µì„±ì „' },
            { id: 'temple', name: 'ì´ì„¸ê³„: ì‹œê°„ì˜ ì‚¬ì›' },
            { id: 'kounat', name: 'ì´ì„¸ê³„: ì½”ìš°ë‚˜íŠ¸ ëŒ€í­ë°œ' },
        ],
        weekly: [
            { id: 'w_furnace', name: 'ì§€ì˜¥ì˜ ìš©ê´‘ë¡œ' },
            { id: 'w_sanctum', name: 'íŒŒë©¸ì˜ ì„±ì†Œ' },
            { id: 'w_laby', name: 'í™˜ì˜ì˜ ë¯¸ê¶' }
        ]
    };

    let characters = []; // ì „ì²´ ìºë¦­í„° ë°ì´í„°
    let currentChrId = null; // í˜„ì¬ ì„ íƒëœ ìºë¦­í„° ID

    // === 2. ë°ì´í„° ì´ˆê¸°í™”/ë¶ˆëŸ¬ì˜¤ê¸° ===

    // ì´ˆê¸°í™” ì‹œ ë¹ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
    const generateInitialTasks = (type) => {
        const tasks = {};
        DUNGEON_DATA[type].forEach(d => {
            tasks[d.id] = false;
        });
        return tasks;
    };

    function initializeData() {
        const savedData = localStorage.getItem('gc_characters');
        const lastReset = localStorage.getItem('lastResetTime');

        if (savedData) {
            characters = JSON.parse(savedData);
        } else {
            // ë¡œì»¬ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 24ê°œ ìºë¦­í„° ìƒì„±
            characters = CHARACTER_NAMES.map((name, index) => ({
                id: index + 1,
                name: name,
                dailyTasks: generateInitialTasks('daily'),
                weeklyTasks: generateInitialTasks('weekly')
            }));
            localStorage.setItem('gc_characters', JSON.stringify(characters));
        }
        
        // í˜„ì¬ ì„ íƒëœ ìºë¦­í„° ID ì„¤ì • (ì—†ìœ¼ë©´ ì—˜ë¦¬ì‹œìŠ¤)
        currentChrId = localStorage.getItem('currentChrId') || characters[0].id;
        
        // ì´ˆê¸°í™” ë¡œì§ ì‹¤í–‰
        checkAndApplyReset(characters, lastReset);
    }

    // === 3. ì´ˆê¸°í™” ë¡œì§ (í•µì‹¬) ===
    function checkAndApplyReset(currentChars, lastResetTime) {
        const now = new Date();
        const kstNow = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
        let isDailyReset = false;
        let isWeeklyReset = false;

        // -- ì¼ì¼ ì´ˆê¸°í™” ê¸°ì¤€ (ì˜¤ëŠ˜ ì˜¤í›„ 3ì‹œ) --
        let dailyResetPoint = new Date(kstNow);
        if (kstNow.getHours() < 15) { 
            dailyResetPoint.setDate(dailyResetPoint.getDate() - 1);
        }
        dailyResetPoint.setHours(15, 0, 0, 0);

        // -- ì£¼ê°„ ì´ˆê¸°í™” ê¸°ì¤€ (ì´ë²ˆ ì£¼ ìˆ˜ìš”ì¼ ì˜¤í›„ 3ì‹œ) --
        let weeklyResetPoint = new Date(kstNow);
        const day = weeklyResetPoint.getDay(); // 0:ì¼, 1:ì›”, ... 3:ìˆ˜
        const diff = (day + 7 - 3) % 7; 
        weeklyResetPoint.setDate(weeklyResetPoint.getDate() - diff);
        weeklyResetPoint.setHours(15, 0, 0, 0);
        if (weeklyResetPoint > kstNow) weeklyResetPoint.setDate(weeklyResetPoint.getDate() - 7);

        // ë§ˆì§€ë§‰ ì ‘ì†/ì´ˆê¸°í™” ì‹œê°„ (ë°€ë¦¬ì´ˆ)
        const lastCheckTime = lastResetTime ? parseInt(lastResetTime) : 0;
        
        // ì¼ì¼ ì´ˆê¸°í™” í•„ìš” ì²´í¬
        if (lastCheckTime < dailyResetPoint.getTime()) {
            isDailyReset = true;
        }

        // ì£¼ê°„ ì´ˆê¸°í™” í•„ìš” ì²´í¬
        if (lastCheckTime < weeklyResetPoint.getTime()) {
            isWeeklyReset = true;
        }

        if (isDailyReset || isWeeklyReset) {
            console.log(`Resetting: Daily=${isDailyReset}, Weekly=${isWeeklyReset}`);
            
            // ëª¨ë“  ìºë¦­í„°ì— ì´ˆê¸°í™” ì ìš©
            characters = currentChars.map(char => {
                let newChar = {...char};
                if (isDailyReset) newChar.dailyTasks = generateInitialTasks('daily');
                if (isWeeklyReset) newChar.weeklyTasks = generateInitialTasks('weekly');
                return newChar;
            });

            // ê°±ì‹ ëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì•Œë¦¼
            localStorage.setItem('gc_characters', JSON.stringify(characters));
            localStorage.setItem('lastResetTime', now.getTime());
            
            //alert("ìˆ™ì œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!"); // ì´ˆê¸°í™” ì•Œë¦¼ì€ ë„ˆë¬´ ìì£¼ ëœ° ìˆ˜ ìˆìœ¼ë‹ˆ ì½˜ì†”ë¡œ ëŒ€ì²´
        }
    }

    // === 4. ì•¡ì…˜ í•¸ë“¤ëŸ¬ ===

    // ìºë¦­í„° ì „í™˜
    function selectCharacter(id) {
        currentChrId = id;
        localStorage.setItem('currentChrId', id);
        render(); // í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    }

    // ì²´í¬ë°•ìŠ¤ ìƒíƒœ í† ê¸€
    function toggleTask(chrId, type, taskId) {
        const charIndex = characters.findIndex(c => c.id === chrId);
        if (charIndex === -1) return;

        const char = characters[charIndex];
        
        // ìƒíƒœ ë³€ê²½
        const newStatus = !char[`${type}Tasks`][taskId];
        char[`${type}Tasks`] = {
            ...char[`${type}Tasks`],
            [taskId]: newStatus
        };

        // ë°ì´í„° ì €ì¥ ë° í™”ë©´ ê°±ì‹ 
        localStorage.setItem('gc_characters', JSON.stringify(characters));
        render();
    }

    // === 5. í™”ë©´ ë Œë”ë§ ===

    // ìºë¦­í„° ë²„íŠ¼ ëª©ë¡ í‘œì‹œ
    function renderCharacterSelector() {
        const selector = document.getElementById('character-selector');
        selector.innerHTML = '';

        characters.forEach(char => {
            const button = document.createElement('button');
            button.className = `char-btn ${char.id == currentChrId ? 'active' : ''}`;
            button.innerText = char.name;
            button.onclick = () => selectCharacter(char.id);
            selector.appendChild(button);
        });
    }

    // í˜„ì¬ ìºë¦­í„°ì˜ ìˆ™ì œ ëª©ë¡ í‘œì‹œ
    function renderTaskList() {
        const currentCharacter = characters.find(c => c.id == currentChrId);
        if (!currentCharacter) {
            document.getElementById('current-char-name').innerText = 'ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
            document.getElementById('task-lists').style.display = 'none';
            return;
        }
        
        document.getElementById('task-lists').style.display = 'block';
        document.getElementById('current-char-name').innerText = `[${currentCharacter.name}] ìˆ™ì œ í˜„í™©`;

        const renderList = (type, listId) => {
            const container = document.getElementById(listId);
            container.innerHTML = '';
            
            DUNGEON_DATA[type].forEach(item => {
                const isChecked = currentCharacter[`${type}Tasks`][item.id] || false;
                
                const div = document.createElement('div');
                // í´ë¦­ ì‹œ ìƒíƒœ í† ê¸€ ì´ë²¤íŠ¸ ì—°ê²°
                div.onclick = () => toggleTask(currentCharacter.id, type, item.id);
                div.className = `task-item ${isChecked ? 'done' : ''}`;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = isChecked;
                checkbox.onclick = (e) => {
                    e.stopPropagation(); // ì¤‘ë³µ í´ë¦­ ë°©ì§€
                    toggleTask(currentCharacter.id, type, item.id);
                };

                const label = document.createElement('label');
                label.innerText = item.name;

                div.appendChild(checkbox);
                div.appendChild(label);
                container.appendChild(div);
            });
        };

        renderList('daily', 'daily-list');
        renderList('weekly', 'weekly-list');
    }
    
    // ì „ì²´ í™”ë©´ ê°±ì‹  í•¨ìˆ˜
    function render() {
        initializeData();
        renderCharacterSelector();
        renderTaskList();
    }

    // === 6. ì‹œì‘ ë° ì£¼ê¸°ì  ì²´í¬ ===
    
    render();
    
    // 1ë¶„ë§ˆë‹¤ ì´ˆê¸°í™” ì‹œê°„ì´ ì§€ë‚¬ëŠ”ì§€ ì²´í¬í•˜ì—¬ ìë™ ë¦¬ì…‹
    setInterval(render, 60000); 

</script>

</body>
</html>